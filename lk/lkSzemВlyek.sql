SELECT tSzemélyek.*, Replace(Nz(IIf(IsNull([tSzemélyek].[Szint 4 szervezeti egység név]),IIf(IsNull([tSzemélyek].[Szint 3 szervezeti egység név]),[tSzemélyek].[Szint 2 szervezeti egység név] & "",[tSzemélyek].[Szint 3 szervezeti egység név] & ""),[tSzemélyek].[Szint 4 szervezeti egység név] & ""),""),"Budapest Fõváros Kormányhivatala ","BFKH ") & "" AS Fõosztály, Replace(Nz(IIf(IsNull(tSzemélyek.[Szint 4 szervezeti egység kód]),IIf(IsNull(tSzemélyek.[Szint 3 szervezeti egység kód]),tSzemélyek.[Szint 2 szervezeti egység kód] & "",tSzemélyek.[Szint 3 szervezeti egység kód] & ""),tSzemélyek.[Szint 4 szervezeti egység kód] & ""),""),"Budapest Fõváros Kormányhivatala ","BFKH ") AS FõosztályKód, [Szint 5 szervezeti egység név] & "" AS Osztály, Replace(Nz([Munkavégzés helye - cím],"")," .",".") AS MunkavégzésCíme, tSzemélyek.[besorolási  fokozat (KT)] AS Besorolás, Replace(Nz([tszemélyek].[Besorolási  fokozat (KT)],[tBesorolásÁtalakítóEltérõBesoroláshoz].[Besorolási  fokozat (KT)]),"/ ","") AS Besorolás2, bfkh(Nz([szervezeti egység kódja],0)) AS BFKH, Replace([Feladatkör],"Lezárt_","") AS Feladat, Nz([Iskolai végzettség foka],"-") AS VégzettségFok
FROM (tSzemélyek INNER JOIN lkÁlláshelyek ON tSzemélyek.[Státusz kódja] = lkÁlláshelyek.[Álláshely azonosító]) LEFT JOIN tBesorolásÁtalakítóEltérõBesoroláshoz ON lkÁlláshelyek.[Álláshely besorolási kategóriája] = tBesorolásÁtalakítóEltérõBesoroláshoz.[Álláshely besorolási kategóriája]
WHERE ((((SELECT Max(Tmp.[Jogviszony sorszáma]) AS [MaxOfJogviszony sorszáma]         FROM tSzemélyek as Tmp         WHERE tSzemélyek.Adójel=Tmp.Adójel         GROUP BY Tmp.Adójel     ))=[Jogviszony sorszáma]))
ORDER BY tSzemélyek.[Dolgozó teljes neve];
